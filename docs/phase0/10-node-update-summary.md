# 10ノード構成への変更まとめ

## 変更理由
**ランダム性の観察を明確化**
- 3ノード: 送信先が2つしかなく、ランダム性が見えにくい
- 10ノード: 送信先が9つあり、統計的分布が明確に観察可能

## 主な変更点

### 1. ポート番号体系
- **変更前**: 8001-8003 (3ポート)
- **変更後**: 18000-18009 (10ポート)
- 理由: より多くのポートを連番で管理しやすく

### 2. ノード命名規則
- **変更前**: node-A, node-B, node-C
- **変更後**: node-0, node-1, ..., node-9
- 理由: プログラマティックな処理が容易

### 3. 設定ファイル構造
```json
// 10ノード版 (各ノードが他の9ノードをpeersに持つ)
{
  "nodes": {
    "node-0": {
      "address": "localhost:18000",
      "peers": ["localhost:18001", ..., "localhost:18009"]
    },
    // ... 9つのノード定義 ...
  }
}
```

## 新規追加ツール

### 設定生成スクリプト (`generate-config.py`)
- 10ノード分の設定を自動生成
- フルメッシュ構成を保証

### 起動スクリプト (`start-10nodes.sh`)
- 10ノードを一括起動
- ヘルスチェック付き
- カラー出力で状態を視覚化

### 観察スクリプト
1. **`observe-randomness.sh`**
   - 100回ゴシップ実行して分布を分析
   - 統計的な偏りを検出
   - バーグラフで視覚化

2. **`observe-convergence.sh`**
   - 値の伝搬過程をリアルタイム追跡
   - 収束までの手数を測定
   - 理論値との比較

## ランダム性の観察ポイント

### 期待される分布
- 100回実行で各ノードに約11回（100÷9）
- 許容範囲: 8-14回程度
- 標準偏差: ±3-4回

### 収束性の期待値
- **10ノードでの理論値**: 20-30ラウンド
- **効率的**: 20ラウンド以下
- **通常**: 20-30ラウンド
- **遅い**: 30ラウンド以上

## 実装への影響

### コード変更不要
基本的な実装は変更不要：
- `selectRandomPeer()`: そのまま動作
- HTTPエンドポイント: 変更なし
- Node構造体: 変更なし

### 設定読み込みの柔軟性
```go
// main.goで任意の設定ファイルを指定可能
configFile := flag.String("config", "config.json", "Config file path")
```

## テスト戦略の調整

### 単体テスト
```go
// ランダム性テストを10ノード用に調整
func TestSelectRandomPeer_10Nodes(t *testing.T) {
    node := &Node{
        Peers: []string{"peer0", "peer1", ..., "peer8"},
    }
    
    counts := make(map[string]int)
    trials := 1000
    
    for i := 0; i < trials; i++ {
        peer := node.selectRandomPeer()
        counts[peer]++
    }
    
    // 各ピアが80-130回程度選ばれることを確認
    for peer, count := range counts {
        assert.InRange(t, count, 80, 130)
    }
}
```

### 統合テスト
- 10ノード全体の起動確認
- 収束時間の測定（20-30ラウンド）
- 分布の均等性確認

## 利点

### 1. 統計的有意性
- サンプル数が増えて統計的に意味のある結果
- カイ二乗検定などの統計手法が適用可能

### 2. 現実的なシミュレーション
- 実際の分散システムに近い規模
- スケーラビリティの初期検証

### 3. 視覚的理解
- 伝搬パスが複雑になり、ゴシップの威力を実感
- ランダムウォークの様子が明確

## 実行例

```bash
# 1. 設定生成
python3 generate-config.py

# 2. 10ノード起動
./start-10nodes.sh

# 3. ランダム性観察
./observe-randomness.sh 100

# 4. 収束性観察
./observe-convergence.sh
```

この10ノード構成により、**ゴシッププロトコルの確率的性質**がより明確に観察でき、Phase 0の学習効果が大幅に向上します。